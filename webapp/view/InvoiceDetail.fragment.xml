<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:table="sap.ui.table"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:layout="sap.ui.layout.form"
>
    <Dialog
        id="orderDetailDialog"
        title="{i18n>InvoiceDetails}"
        draggable="true"
        resizable="true"
        contentWidth="80%"
        contentHeight="90%"
        class="sapUiContentPadding"
    >
        <!-- selectedKey="{dialogModel>/PayMethodSelectedKey}" -->
        
        <Label text="Payment Type" />
        <Select
            id="payMethodChangeid"
            selectedKey="{dialogModel>/PayType}"
            width="30%"
            change="onDialogPayTypeChange"
            class="sapUiSmallMarginTop sapUiSmallMarginBottom sapUiSmallMarginBegin"
        >
            <core:Item
                key="Full"
                text="Full"
            />
            <core:Item
                key="Partial"
                text="Partial"
            />
        </Select>

        <layout:SimpleForm
            editable="true"
            layout="ResponsiveGridLayout"
            labelSpanM="3"
            labelSpanL="2"
            emptySpanL="2"
            columnsL="2"
            columnsM="1"
        >
            <Label text="Total Approval Amt" />

            <Input
                id="totalAmountText"
                value="{dialogModel>/ApprovalAmount}" 
                editable="{= ${dialogModel>/PayType} === 'Partial' }"
                width="150px"
                textAlign="End"
                class="sapUiSmallMarginEnd" 
                valueLiveUpdate="true"
                liveChange=".onFieldValueChange"  
            >
             <customData>
                                <core:CustomData
                                    key="field"
                                    value="ApprovalAmount"
                                />
                            </customData>
                        </Input>

            <Label text="Total O/S Amt" />
            <Text
                text="{dialogModel>/TotalAmount}"
                textAlign="End"
                width="150px"
                class="sapUiSmallMarginEnd"
            />

            <!-- <Label text="{i18n>Project}" />
             <Input editable="false" width="150px" id="project" textAlign="End"
     value="{path:'dialogModel>/Project'}" /> -->
       
        </layout:SimpleForm>
        
        <Table
            id="invoiceTable"
            items="{dialogModel>/Invoices}"
            width="100%"
        >
            <!-- <headerToolbar>
                <Toolbar>
                    <Title text="{Total amount}" />
                </Toolbar>
            </headerToolbar> -->
            <columns>
                <Column>
                    <header>
                        <Label text="{i18n>Catagory}" />
                    </header>
                </Column>
                <Column>
                    <header>
                        <Label text="{i18n>DocumentNo}" />
                    </header>
                </Column>
                <Column>
                    <header>
                        <Label text="{i18n>InvoiceDate}" />
                    </header>
                </Column>
                <Column>
                    <header>
                        <Label text="{i18n>DocumentAmount}" />
                    </header>
                </Column>
                <Column>
                    <header>
                        <Label text="{i18n>FullPayment}" />
                    </header>
                </Column>
                <Column>
                    <header>
                        <Label text="{i18n>ApprovalAmount}" />
                    </header>
                </Column>
                <Column>
                    <header>
                        <Label text="{i18n>InvoiceNo}" />
                    </header>
                </Column>
            </columns>

            <items>
                <ColumnListItem type="Active">
                    <cells>
                        <Text
                            text="{path: 'dialogModel>Category', formatter: '.formatCategory'}"
                        />
                        <Text text="{dialogModel>Docnr}" />
                        <Text
                            text="{path:'dialogModel>Budat',formatter:'.formatDate'}"
                        />
                        <Text
                            text="{path:'dialogModel>DocAmt',formatter:'.formatAmount'}"
                        />

                        <CheckBox
                            selected="{= parseFloat(${dialogModel>ApprovalAmt}).toFixed(2) === parseFloat(${dialogModel>DocAmt}).toFixed(2) }"
                            enabled="{= ${dialogModel>/PayType} === 'Partial' }"
                            select=".onFullPaymentSelected"
                        />
                        <Input
                            value="{path: 'dialogModel>ApprovalAmt',formatter: '.formatAmount'}" 
                            editable="{= ${dialogModel>/PayType} === 'Partial' }"
                            placeholder="Enter amount"
                            liveChange=".onFieldValueChange"
                            valueLiveUpdate="true"
                            type="Number"
                        >
                            <customData>
                                <core:CustomData
                                    key="field"
                                    value="ApprovalAmt"
                                />
                            </customData>
                        </Input>

                        <Text text="{dialogModel>Xblnr}" />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>

        <endButton>
            <!-- <beginButton> -->
            <Button
                text="{i18n>Confirm}"
                type="Emphasized"
                press="onCloseOrderDialog"
            />
            <!-- </beginButton> -->
        </endButton>
        <!-- <endButton>
            <Button
                text="{i18n>Cancel}"
                press="onCancelOrderDialog"
            />
        </endButton> -->
    </Dialog>
</core:FragmentDefinition>
