<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:table="sap.ui.table"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:f="sap.ui.layout.form"
>
    <Dialog
        id="orderDetailDialog"
        title="{i18n>InvoiceDetails}"
        draggable="true"
        resizable="true"
        contentWidth="80%"
        contentHeight="90%"
        class="sapUiContentPadding"
    >
        <!-- selectedKey="{dialogModel>/PayMethodSelectedKey}" -->
        
       <f:Form editable="true">
                        <f:layout>
                            <f:ResponsiveGridLayout
                                    labelSpanXL="3"
                                    labelSpanL="4"
                                    labelSpanM="6"
                                    labelSpanS="12"
                                    adjustLabelSpan="false"
                                    emptySpanXL="0"
                                    emptySpanL="0"
                                    emptySpanM="0"
                                    emptySpanS="0"
                                    columnsXL="3"
                                    columnsL="3"
                                    columnsM="3"
                                    />
                            </f:layout>
                            <f:formContainers>
                                <f:FormContainer>
                                <f:formElements>

                    <f:FormElement label="Payment Type">
                    <f:fields>
                <Select
            id="payMethodChangeid"
            selectedKey="{dialogModel>/PayType}"
            width="100%"
            change="onDialogPayTypeChange"
            
        >
            <core:Item
                key="Full"
                text="Full"
            />
            <core:Item
                key="Partial"
                text="Partial"
            />
        </Select>
                    </f:fields>
                    </f:FormElement>
                </f:formElements>
                </f:FormContainer>
                <f:FormContainer>
                <f:formElements>

                    <!-- 1st element -->
                    <f:FormElement label="Total Approval Amt">
                    <f:fields>
                          <Input
                id="totalAmountText"
                value="{dialogModel>/ApprovalAmount}"                 
                editable="{= ${dialogModel>/PayType} === 'Partial' }"
                width="100%"
                textAlign="End"
                class="sapUiSmallMarginEnd" 
                valueLiveUpdate="true"
                liveChange=".onFieldValueChange"  
            >
             <customData>
                                <core:CustomData
                                    key="field"
                                    value="ApprovalAmount"
                                />
                            </customData>
                        </Input>
                    </f:fields>
                    </f:FormElement>

                </f:formElements>
                </f:FormContainer>
                <f:FormContainer>
                <f:formElements>
                    <f:FormElement label="Total O/S Amt">
                    <f:fields>
                        <Input 
                        value="{dialogModel>/TotalAmount}" 
                
                textAlign="End"
                width="100%"
                editable="false"
                class="sapUiSmallMarginEnd"
            />
                                </f:fields>
                    </f:FormElement>

                </f:formElements>
                </f:FormContainer>
            </f:formContainers>
            </f:Form>

        <Table
            id="invoiceTable"
            items="{dialogModel>/Invoices}"
            width="100%"
        >
            <!-- <headerToolbar>
                <Toolbar>
                    <Title text="{Total amount}" />
                </Toolbar>
            </headerToolbar> -->
            <columns>
                <Column>
                    <header>
                        <Label text="{i18n>Catagory}" />
                    </header>
                </Column>
                <Column>
                    <header>
                        <Label text="{i18n>DocumentNo}" />
                    </header>
                </Column>
                <Column>
                    <header>
                        <Label text="{i18n>InvoiceDate}" />
                    </header>
                </Column>
                <Column>
                    <header>
                        <Label text="{i18n>DocumentAmount}" />
                    </header>
                </Column>
                <Column>
                    <header>
                        <Label text="{i18n>FullPayment}" />
                    </header>
                </Column>
                <Column>
                    <header>
                        <Label text="{i18n>ApprovalAmount}" />
                    </header>
                </Column>
                <Column>
                    <header>
                        <Label text="{i18n>InvoiceNo}" />
                    </header>
                </Column>
            </columns>

            <items>
                <ColumnListItem type="Active">
                    <cells>
                        <Text
                            text="{path: 'dialogModel>Category', formatter: '.formatCategory'}"
                        />
                        <Text text="{dialogModel>Docnr}" />
                        <Text
                            text="{path:'dialogModel>Budat',formatter:'.formatDate'}"
                        />
                        <Text
                            text="{path:'dialogModel>DocAmt',formatter:'.formatAmount'}"
                        />

                        <CheckBox
                            selected="{= parseFloat(${dialogModel>ApprovalAmt}).toFixed(2) === parseFloat(${dialogModel>DocAmt}).toFixed(2) }"
                            enabled="{= ${dialogModel>/PayType} === 'Partial' }"
                            select=".onFullPaymentSelected"
                        />
                        <Input
                            value="{dialogModel>ApprovalAmt}" 
                            editable="{= ${dialogModel>/PayType} === 'Partial' }"
                            placeholder="Enter amount"
                            liveChange=".onFieldValueChange"
                            valueLiveUpdate="true"
                            type="Number"
                        >
                            <customData>
                                <core:CustomData
                                    key="field"
                                    value="ApprovalAmt"
                                />
                            </customData>
                        </Input>

                        <Text text="{dialogModel>Xblnr}" />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>

        <endButton>
            <!-- <beginButton> -->
            <Button
                text="{i18n>Confirm}"
                type="Emphasized"
                press="onCloseOrderDialog"
            />
            <!-- </beginButton> -->
        </endButton>
        <!-- <endButton>
            <Button
                text="{i18n>Cancel}"
                press="onCancelOrderDialog"
            />
        </endButton> -->
    </Dialog>
</core:FragmentDefinition>
